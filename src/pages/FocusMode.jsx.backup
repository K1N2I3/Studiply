import React, { useState, useEffect } from 'react'
import { Play, Pause, Square, Clock, Lock, Unlock, Settings, Smartphone, Monitor, Globe, AlertTriangle, BarChart3 } from 'lucide-react'
import { useTheme } from '../contexts/ThemeContext'

const FocusMode = () => {
  const { isDark } = useTheme()
  const [isActive, setIsActive] = useState(false)
  const [timeLeft, setTimeLeft] = useState(25 * 60) // 25 minutes in seconds
  const [currentSessionStartTime, setCurrentSessionStartTime] = useState(null)
  const [sessionType, setSessionType] = useState('pomodoro')
  const [focusLockEnabled, setFocusLockEnabled] = useState(false)
  const [showStartConfirm, setShowStartConfirm] = useState(false)
  const [hasInitialized, setHasInitialized] = useState(false)
  const [sessionHistory, setSessionHistory] = useState([])
  const [blockedApps, setBlockedApps] = useState([
    { name: 'Facebook', icon: 'üìò', blocked: true },
    { name: 'Instagram', icon: 'üì∑', blocked: true },
    { name: 'TikTok', icon: 'üéµ', blocked: true },
    { name: 'YouTube', icon: 'üì∫', blocked: false },
    { name: 'Twitter', icon: 'üê¶', blocked: true },
    { name: 'Snapchat', icon: 'üëª', blocked: true }
  ])
  const [showFocusReminder, setShowFocusReminder] = useState(false)
  const [pageHiddenCount, setPageHiddenCount] = useState(0)
  const [lastHiddenTime, setLastHiddenTime] = useState(null)
  const [extensionInstalled, setExtensionInstalled] = useState(false)
  const [extensionActive, setExtensionActive] = useState(false)

  const sessionTypes = [
    { id: 'pomodoro', name: 'Pomodoro', duration: 25, color: 'bg-red-500' },
    { id: 'short-break', name: 'Short Break', duration: 5, color: 'bg-green-500' },
    { id: 'long-break', name: 'Long Break', duration: 15, color: 'bg-blue-500' },
    { id: 'deep-work', name: 'Deep Work', duration: 90, color: 'bg-purple-500' }
  ]

  // Load session from localStorage
  const loadSessionFromStorage = () => {
    try {
      const savedSession = localStorage.getItem('studiply_focus_session')
      return savedSession ? JSON.parse(savedSession) : null
    } catch (error) {
      console.error('Failed to load session from localStorage:', error)
      return null
    }
  }

  const clearSessionFromStorage = () => {
    try {
      localStorage.removeItem('studiply_focus_session')
    } catch (error) {
      console.error('Failed to clear session from localStorage:', error)
    }
  }

  // Load session history from localStorage
  const loadSessionHistory = () => {
    try {
      const savedHistory = localStorage.getItem('studiply_focus_history')
      return savedHistory ? JSON.parse(savedHistory) : []
    } catch (error) {
      console.error('Failed to load history from localStorage:', error)
      return []
    }
  }

  // Page Visibility API - Ê£ÄÊµãÁî®Êà∑ÊòØÂê¶Á¶ªÂºÄÈ°µÈù¢
  useEffect(() => {
    const handleVisibilityChange = () => {
      if (isActive && document.hidden) {
        // Áî®Êà∑Á¶ªÂºÄ‰∫ÜÈ°µÈù¢
        setPageHiddenCount(prev => prev + 1)
        setLastHiddenTime(new Date().toISOString())
        setShowFocusReminder(true)
        
        // ‰øùÂ≠òÂà∞localStorage
        const focusData = {
          active: true,
          startTime: currentSessionStartTime,
          pageHiddenCount: pageHiddenCount + 1,
          lastHiddenTime: new Date().toISOString(),
          sessionType: sessionType
        }
        localStorage.setItem('studiply_focus_mode', JSON.stringify(focusData))
      } else if (isActive && !document.hidden) {
        // Áî®Êà∑ÂõûÂà∞‰∫ÜÈ°µÈù¢
        setShowFocusReminder(false)
      }
    }

    // ÁõëÂê¨È°µÈù¢ÂèØËßÅÊÄßÂèòÂåñ
    document.addEventListener('visibilitychange', handleVisibilityChange)
    
    // ÁõëÂê¨Á™óÂè£Â§±ÁÑ¶/Ëé∑ÁÑ¶
    const handleWindowBlur = () => {
      if (isActive) {
        setPageHiddenCount(prev => prev + 1)
        setLastHiddenTime(new Date().toISOString())
        setShowFocusReminder(true)
      }
    }
    
    const handleWindowFocus = () => {
      if (isActive) {
        setShowFocusReminder(false)
      }
    }

    window.addEventListener('blur', handleWindowBlur)
    window.addEventListener('focus', handleWindowFocus)

    return () => {
      document.removeEventListener('visibilitychange', handleVisibilityChange)
      window.removeEventListener('blur', handleWindowBlur)
      window.removeEventListener('focus', handleWindowFocus)
    }
  }, [isActive, pageHiddenCount, currentSessionStartTime, sessionType])

  // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü•‰∏ìÊ≥®Ê®°ÂºèÁä∂ÊÄÅ
  useEffect(() => {
    const checkFocusModeStatus = () => {
      try {
        const focusData = localStorage.getItem('studiply_focus_mode')
        if (focusData) {
          const data = JSON.parse(focusData)
          if (data.active) {
            // ÊÅ¢Â§ç‰∏ìÊ≥®Ê®°ÂºèÁä∂ÊÄÅ
            setIsActive(true)
            setCurrentSessionStartTime(data.startTime)
            setPageHiddenCount(data.pageHiddenCount || 0)
            setLastHiddenTime(data.lastHiddenTime)
            setSessionType(data.sessionType || 'pomodoro')
            setTimeLeft(data.timeLeft || 25 * 60)
            
            // Â¶ÇÊûúÁî®Êà∑ÂàöÂàöÂõûÂà∞È°µÈù¢ÔºåÊòæÁ§∫ÊèêÈÜí
            if (data.lastHiddenTime) {
              const timeSinceHidden = Date.now() - new Date(data.lastHiddenTime).getTime()
              if (timeSinceHidden < 5000) { // 5ÁßíÂÜÖ
                setShowFocusReminder(true)
              }
            }
          }
        }
      } catch (error) {
        console.error('Failed to check focus mode status:', error)
      }
    }

    checkFocusModeStatus()
  }, [])

  // Ê£ÄÊµãÊâ©Â±ïÁ®ãÂ∫èÊòØÂê¶ÂÆâË£Ö
  useEffect(() => {
    const checkExtension = () => {
      // Ê£ÄÊü•ÊòØÂê¶ÊúâÊâ©Â±ïÁ®ãÂ∫è
      if (window.chrome && window.chrome.runtime) {
        setExtensionInstalled(true)
        
        // ÁõëÂê¨Êâ©Â±ïÁ®ãÂ∫èÊ∂àÊÅØ
        window.addEventListener('message', (event) => {
          if (event.origin !== window.location.origin) return
          
          const { type, data } = event.data
          
          if (type === 'STUDIPLY_EXTENSION_LOADED') {
            setExtensionInstalled(true)
            console.log('Extension detected and loaded')
          } else if (type === 'STUDIPLY_EXTENSION_READY') {
            setExtensionActive(true)
            console.log('Extension is ready and active')
          } else if (type === 'STUDIPLY_EXTENSION_STOPPED') {
            setExtensionActive(false)
            console.log('Extension focus mode stopped')
          } else if (type === 'STUDIPLY_EXTENSION_STATUS') {
            setExtensionInstalled(true)
            setExtensionActive(data.active)
            console.log('Extension status:', data)
          }
        })
        
        // ËØ∑Ê±ÇÊâ©Â±ïÁ®ãÂ∫èÁä∂ÊÄÅ
        window.postMessage({
          type: 'STUDIPLY_GET_EXTENSION_STATUS'
        }, window.location.origin)
      } else {
        setExtensionInstalled(false)
      }
    }

    checkExtension()
  }, [])

  // ‰∏ìÊ≥®ÈîÅÂÆöÂäüËÉΩ - ÈòªÊ≠¢Áî®Êà∑Á¶ªÂºÄÈ°µÈù¢
  useEffect(() => {
    if (isActive && focusLockEnabled) {
      const handleBeforeUnload = (e) => {
        e.preventDefault()
        e.returnValue = 'Focus session is in progress. Are you sure you want to leave?'
        return 'Focus session is in progress. Are you sure you want to leave?'
      }

      const handleVisibilityChange = () => {
        if (document.hidden && isActive && focusLockEnabled) {
          // Â¶ÇÊûúÁî®Êà∑ÂàáÊç¢Âà∞ÂÖ∂‰ªñÊ†áÁ≠æÈ°µÔºåÊòæÁ§∫Ë≠¶Âëä
          alert('Focus session is in progress. Please return to this page.')
        }
      }

      window.addEventListener('beforeunload', handleBeforeUnload)
      document.addEventListener('visibilitychange', handleVisibilityChange)

      // Ê∏ÖÁêÜÂáΩÊï∞
      return () => {
        window.removeEventListener('beforeunload', handleBeforeUnload)
        document.removeEventListener('visibilitychange', handleVisibilityChange)
      }
    }
  }, [isActive, focusLockEnabled])

  // ÂàùÂßãÂåñ
  useEffect(() => {
    if (!hasInitialized) {
      const savedSession = loadSessionFromStorage()
      const savedHistory = loadSessionHistory()
      
      if (savedSession) {
        setTimeLeft(savedSession.timeLeft)
        setIsActive(savedSession.isActive)
        setCurrentSessionStartTime(savedSession.startTime)
        setSessionType(savedSession.sessionType)
        setFocusLockEnabled(savedSession.focusLockEnabled)
      }
      
      setSessionHistory(savedHistory)
      setHasInitialized(true)
    }
  }, [hasInitialized])

  // ‰øùÂ≠òsessionÂà∞localStorage
  useEffect(() => {
    if (hasInitialized) {
      const sessionData = {
        timeLeft,
        isActive,
        startTime: currentSessionStartTime,
        sessionType,
        focusLockEnabled
      }
      localStorage.setItem('studiply_focus_session', JSON.stringify(sessionData))
    }
  }, [timeLeft, isActive, currentSessionStartTime, sessionType, focusLockEnabled, hasInitialized])

  // ËÆ°Êó∂Âô®ÈÄªËæë
  useEffect(() => {
    let interval = null
    
    if (isActive && timeLeft > 0) {
      interval = setInterval(() => {
        setTimeLeft(timeLeft => {
          const newTime = timeLeft - 1
          if (newTime === 0) {
            // Session completed
            const sessionData = {
              id: Date.now(),
              type: sessionTypes.find(s => s.id === sessionType)?.name || 'Pomodoro',
              duration: sessionTypes.find(s => s.id === sessionType)?.duration || 25,
              startTime: currentSessionStartTime,
              endTime: new Date().toISOString()
            }
            
            const newHistory = [...sessionHistory, sessionData]
            setSessionHistory(newHistory)
            localStorage.setItem('studiply_focus_history', JSON.stringify(newHistory))
            
            setIsActive(false)
            setCurrentSessionStartTime(null)
            clearSessionFromStorage()
            
            // Êí≠ÊîæÂÆåÊàêÈü≥Êïà
            if ('Notification' in window && Notification.permission === 'granted') {
              new Notification('Focus Session Completed!', {
                body: 'Great job! Your focus session is complete.',
                icon: '/favicon.ico'
              })
            }
          }
          return newTime
        })
      }, 1000)
    } else if (!isActive && timeLeft !== 0) {
      clearInterval(interval)
    }
    return () => clearInterval(interval)
  }, [isActive, timeLeft, currentSessionStartTime, sessionType, sessionTypes, sessionHistory])

  // ÁõëÂê¨timeLeftÂèòÂåñÔºåÊõ¥Êñ∞localStorage‰∏≠ÁöÑÂâ©‰ΩôÊó∂Èó¥
  useEffect(() => {
    if (currentSessionStartTime) {
      const sessionData = {
        timeLeft,
        isActive,
        startTime: currentSessionStartTime,
        sessionType,
        focusLockEnabled
      }
      localStorage.setItem('studiply_focus_session', JSON.stringify(sessionData))
    }
  }, [timeLeft, isActive, currentSessionStartTime, sessionType, focusLockEnabled])

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60)
    const secs = seconds % 60
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
  }

  const formatSessionTime = (date) => {
    // Â¶ÇÊûú‰º†ÂÖ•ÁöÑÊòØÂ≠óÁ¨¶‰∏≤ÔºåËΩ¨Êç¢‰∏∫DateÂØπË±°
    const dateObj = typeof date === 'string' ? new Date(date) : date
    return dateObj.toLocaleTimeString('en-US', { 
      hour: 'numeric', 
      minute: '2-digit',
      hour12: true 
    })
  }

  const startSession = () => {
    if (focusLockEnabled) {
      setShowStartConfirm(true)
      return
    }

    // Áõ¥Êé•ÂºÄÂßãsession
    startSessionConfirmed()
  }

  const startSessionConfirmed = () => {
    const selectedSession = sessionTypes.find(s => s.id === sessionType)
    if (selectedSession) {
      // Á°Æ‰øù‰ΩøÁî®ÂΩìÂâçÈÄâÊã©ÁöÑsessionÁ±ªÂûãÁöÑÊó∂Èó¥
      setTimeLeft(selectedSession.duration * 60)
      setIsActive(true)
      setCurrentSessionStartTime(new Date().toISOString())
      setShowStartConfirm(false)
      
      // ÈáçÁΩÆ‰∏ìÊ≥®ÊèêÈÜíÁä∂ÊÄÅ
      setPageHiddenCount(0)
      setLastHiddenTime(null)
      setShowFocusReminder(false)
      
      // ‰øùÂ≠ò‰∏ìÊ≥®Ê®°ÂºèÁä∂ÊÄÅÂà∞localStorage
      const focusData = {
        active: true,
        startTime: new Date().toISOString(),
        pageHiddenCount: 0,
        lastHiddenTime: null,
        sessionType: sessionType,
        timeLeft: selectedSession.duration * 60
      }
      localStorage.setItem('studiply_focus_mode', JSON.stringify(focusData))
      
      // Â¶ÇÊûúÊâ©Â±ïÁ®ãÂ∫èÂ∑≤ÂÆâË£ÖÔºåÂèëÈÄÅÂêØÂä®Ê∂àÊÅØ
      console.log('üîç Extension installed:', extensionInstalled)
      console.log('üîç Extension active:', extensionActive)
      
      // Â∞ùËØïÂèëÈÄÅÂêØÂä®Ê∂àÊÅØÔºå‰∏çÁÆ°Êâ©Â±ïÁ®ãÂ∫èÁä∂ÊÄÅÂ¶Ç‰Ωï
      // Â¶ÇÊûúÊâ©Â±ïÁ®ãÂ∫èÂ≠òÂú®ÔºåÂÆÉ‰ºöÂìçÂ∫îÔºõÂ¶ÇÊûú‰∏çÂ≠òÂú®ÔºåÊ∂àÊÅØ‰ºöË¢´ÂøΩÁï•
      const blockedSites = blockedApps
        .filter(app => app.blocked)
        .map(app => {
          // Â∞ÜÂ∫îÁî®ÂêçÁß∞ËΩ¨Êç¢‰∏∫ÂüüÂêç
          const siteMap = {
            'Facebook': 'facebook.com',
            'Instagram': 'instagram.com',
            'TikTok': 'tiktok.com',
            'YouTube': 'youtube.com',
            'Twitter': 'twitter.com',
            'Snapchat': 'snapchat.com'
          }
          return siteMap[app.name] || app.name.toLowerCase() + '.com'
        })
      
      console.log('üöÄ Sending focus start message with blocked sites:', blockedSites)
      window.postMessage({
        type: 'STUDIPLY_FOCUS_START',
        data: {
          sessionType: sessionType,
          duration: selectedSession.duration,
          startTime: new Date().toISOString(),
          blockedSites: blockedSites
        }
      }, window.location.origin)
    }
  }

  const pauseSession = () => {
    setIsActive(false)
  }

  const resumeSession = () => {
    setIsActive(true)
  }

  const stopSession = () => {
    setIsActive(false)
    setCurrentSessionStartTime(null)
    const selectedSession = sessionTypes.find(s => s.id === sessionType)
    if (selectedSession) {
      // ÈáçÁΩÆÂà∞ÂΩìÂâçÈÄâÊã©ÁöÑsessionÁ±ªÂûãÁöÑÂÆåÊï¥Êó∂Èó¥
      setTimeLeft(selectedSession.duration * 60)
    }
    clearSessionFromStorage()
    
    // Ê∏ÖÈô§‰∏ìÊ≥®Ê®°ÂºèÁä∂ÊÄÅ
    setPageHiddenCount(0)
    setLastHiddenTime(null)
    setShowFocusReminder(false)
    localStorage.removeItem('studiply_focus_mode')
    
    // ÂèëÈÄÅÂÅúÊ≠¢Ê∂àÊÅØÁªôÊâ©Â±ïÁ®ãÂ∫èÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
    console.log('üõë Sending focus stop message')
    window.postMessage({
      type: 'STUDIPLY_FOCUS_STOP'
    }, window.location.origin)
  }

  const toggleFocusLock = () => {
    setFocusLockEnabled(!focusLockEnabled)
  }

  const cancelStartSession = () => {
    setShowStartConfirm(false)
  }

  const getSessionColor = () => {
    const session = sessionTypes.find(s => s.id === sessionType)
    return session ? session.color : 'bg-gray-500'
  }

  const toggleAppBlock = (appName) => {
    setBlockedApps(prev => prev.map(app => 
      app.name === appName ? { ...app, blocked: !app.blocked } : app
    ))
  }

  return (
    <div className={`min-h-screen ${
      isDark 
        ? 'bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900' 
        : 'bg-gradient-to-br from-blue-50 via-white to-purple-50'
    }`}>
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Header */}
        <div className="text-center mb-12">
          <div className="relative inline-block">
            <div className={`absolute inset-0 rounded-3xl blur-xl ${
              isDark 
                ? 'bg-gradient-to-r from-purple-500/30 to-blue-500/30 shadow-2xl shadow-purple-500/20' 
                : 'bg-gradient-to-r from-purple-500/20 to-blue-500/20 shadow-2xl shadow-purple-300/30'
            }`}></div>
            <div className={`relative backdrop-blur-sm rounded-3xl shadow-2xl border px-8 py-6 ${
              isDark 
                ? 'bg-white/10 border-white/20' 
                : 'bg-white/80 border-white/20'
            }`}>
              <h1 className={`text-4xl font-bold mb-2 ${
                isDark 
                  ? 'bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent' 
                  : 'bg-gradient-to-r from-purple-700 to-blue-700 bg-clip-text text-transparent'
              }`}>
                Focus Mode
              </h1>
              <p className={`text-lg ${
                isDark ? 'text-white/70' : 'text-gray-600'
              }`}>
                Stay focused, stay productive
              </p>
            </div>
          </div>
        </div>

        {/* Timer Section - Full Width */}
        <div className="relative mb-8">
          <div className={`absolute inset-0 rounded-3xl blur-xl ${
            isDark 
              ? 'bg-gradient-to-r from-blue-500/20 to-purple-500/20 shadow-2xl shadow-blue-500/10' 
              : 'bg-gradient-to-r from-blue-500/10 to-purple-500/10 shadow-2xl shadow-blue-300/20'
          }`}></div>
          <div className={`relative backdrop-blur-sm rounded-3xl shadow-2xl border overflow-hidden ${
            isDark 
              ? 'bg-white/10 border-white/20' 
              : 'bg-white/80 border-white/20'
          }`}>
            <div className="bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 p-6 text-white relative overflow-hidden">
              {/* Background Pattern */}
              <div className="absolute inset-0 opacity-10">
                <div className="absolute top-0 left-0 w-32 h-32 bg-white rounded-full -translate-x-16 -translate-y-16"></div>
                <div className="absolute bottom-0 right-0 w-24 h-24 bg-white rounded-full translate-x-12 translate-y-12"></div>
              </div>
              
              <div className="relative z-10 text-center">
                <div className="mb-6">
                  <div className="text-6xl font-bold mb-2 font-mono">{formatTime(timeLeft)}</div>
                  <div className="text-xl opacity-90">{sessionTypes.find(s => s.id === sessionType)?.name}</div>
                </div>
                
                <div className="flex justify-center space-x-4 mb-6">
                  {!isActive ? (
                    <button
                      onClick={startSession}
                      className="bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white px-8 py-3 rounded-2xl font-semibold transition-all duration-200 hover:scale-105 flex items-center space-x-2"
                    >
                      <Play className="w-5 h-5" />
                      <span>Start</span>
                    </button>
                  ) : (
                    <>
                      <button
                        onClick={pauseSession}
                        className="bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white px-6 py-3 rounded-2xl font-semibold transition-all duration-200 hover:scale-105 flex items-center space-x-2"
                      >
                        <Pause className="w-5 h-5" />
                        <span>Pause</span>
                      </button>
                      <button
                        onClick={stopSession}
                        className="bg-red-500/80 backdrop-blur-sm hover:bg-red-500 text-white px-6 py-3 rounded-2xl font-semibold transition-all duration-200 hover:scale-105 flex items-center space-x-2"
                      >
                        <Square className="w-5 h-5" />
                        <span>Stop</span>
                      </button>
                    </>
                  )}
                </div>

                <div className="flex justify-center space-x-4">
                  {sessionTypes.map((type) => (
                    <button
                      key={type.id}
                      onClick={() => {
                        setSessionType(type.id)
                        // Âè™ÊúâÂú®sessionÊ≤°ÊúâËøõË°å‰∏≠Êó∂ÊâçÊõ¥Êñ∞Êó∂Èó¥
                        if (!isActive) {
                          setTimeLeft(type.duration * 60)
                        }
                      }}
                      className={`px-4 py-2 rounded-xl font-medium transition-all duration-200 ${
                        sessionType === type.id
                          ? 'bg-white/30 text-white'
                          : 'bg-white/10 text-white/70 hover:bg-white/20'
                      }`}
                    >
                      {type.name}
                    </button>
                  ))}
                </div>

                {/* Extension Status */}
                <div className="mt-6 text-center">
                  {extensionInstalled ? (
                    <div className={`inline-flex items-center space-x-2 px-4 py-2 rounded-xl ${
                      extensionActive 
                        ? 'bg-green-500/20 text-green-400 border border-green-500/30' 
                        : 'bg-blue-500/20 text-blue-400 border border-blue-500/30'
                    }`}>
                      <div className={`w-2 h-2 rounded-full ${
                        extensionActive ? 'bg-green-400 animate-pulse' : 'bg-blue-400'
                      }`}></div>
                      <span className="text-sm font-medium">
                        {extensionActive ? 'Extension Active' : 'Extension Ready'}
                      </span>
                    </div>
                  ) : (
                    <div className="space-y-3">
                      <div className="inline-flex items-center space-x-2 px-4 py-2 rounded-xl bg-orange-500/20 text-orange-400 border border-orange-500/30">
                      <div className="w-2 h-2 rounded-full bg-orange-400"></div>
                      <span className="text-sm font-medium">Install Extension for Website Blocking</span>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Ultra Cool Grid Layout */}
        <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
          
          {/* Card 1: Blocked Apps */}
          <div className="relative group">
            <div className={`absolute inset-0 rounded-3xl blur-xl transition-all duration-500 group-hover:blur-2xl ${
              isDark 
                ? 'bg-gradient-to-r from-red-500/30 to-pink-500/30 shadow-2xl shadow-red-500/20' 
                : 'bg-gradient-to-r from-red-500/20 to-pink-500/20 shadow-2xl shadow-red-300/30'
            }`}></div>
            <div className={`relative backdrop-blur-sm rounded-3xl shadow-2xl border overflow-hidden transition-all duration-300 group-hover:scale-105 ${
              isDark 
                ? 'bg-white/10 border-white/20 group-hover:border-red-400/50' 
                : 'bg-white/90 border-white/20 group-hover:border-red-200/50'
            }`}>
              <div className="bg-gradient-to-br from-red-500 via-pink-500 to-purple-600 p-6 text-white relative overflow-hidden">
                <div className="absolute inset-0 opacity-20">
                  <div className="absolute top-0 right-0 w-20 h-20 bg-white rounded-full -translate-y-10 translate-x-10 animate-pulse"></div>
                  <div className="absolute bottom-0 left-0 w-16 h-16 bg-white rounded-full translate-y-8 -translate-x-8 animate-pulse delay-1000"></div>
                </div>
                <div className="relative z-10">
                  <div className="flex items-center space-x-3 mb-4">
                    <div className="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center">
                      <Settings className="w-6 h-6 text-white" />
                    </div>
                    <h3 className="text-xl font-bold">Blocked Apps</h3>
                  </div>
                  <p className="text-white/80 text-sm">Manage distracting applications</p>
                </div>
              </div>
              
              <div className="p-6">
                <div className="space-y-3">
                  {blockedApps.slice(0, 3).map((app, index) => (
                    <div key={index} className="flex items-center justify-between p-3 bg-gradient-to-r from-gray-50 to-red-50 rounded-xl border border-gray-100 hover:shadow-md transition-all duration-200">
                      <div className="flex items-center space-x-3">
                        <span className="text-2xl">{app.icon}</span>
                        <div>
                          <div className="font-semibold text-gray-900 text-sm">{app.name}</div>
                          <div className={`text-xs font-medium ${
                            app.blocked ? 'text-red-600' : 'text-green-600'
                          }`}>
                            {app.blocked ? 'Blocked' : 'Allowed'}
                          </div>
                        </div>
                      </div>
                      <button
                        onClick={() => toggleAppBlock(app.name)}
                        className={`relative inline-flex h-5 w-9 items-center rounded-full transition-all duration-200 ${
                          app.blocked ? 'bg-gradient-to-r from-red-500 to-pink-500' : 'bg-gray-200'
                        }`}
                      >
                        <span
                          className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200 ${
                            app.blocked ? 'translate-x-4' : 'translate-x-0.5'
                          }`}
                        />
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>

          {/* Card 2: Device Control */}
          <div className="relative group">
            <div className={`absolute inset-0 rounded-3xl blur-xl transition-all duration-500 group-hover:blur-2xl ${
              isDark 
                ? 'bg-gradient-to-r from-blue-500/30 to-cyan-500/30 shadow-2xl shadow-blue-500/20' 
                : 'bg-gradient-to-r from-blue-500/20 to-cyan-500/20 shadow-2xl shadow-blue-300/30'
            }`}></div>
            <div className={`relative backdrop-blur-sm rounded-3xl shadow-2xl border overflow-hidden transition-all duration-300 group-hover:scale-105 ${
              isDark 
                ? 'bg-white/10 border-white/20 group-hover:border-blue-400/50' 
                : 'bg-white/90 border-white/20 group-hover:border-blue-200/50'
            }`}>
              <div className="bg-gradient-to-br from-blue-500 via-cyan-500 to-indigo-600 p-6 text-white relative overflow-hidden">
                <div className="absolute inset-0 opacity-20">
                  <div className="absolute top-0 left-0 w-20 h-20 bg-white rounded-full -translate-y-10 -translate-x-10 animate-pulse delay-500"></div>
                  <div className="absolute bottom-0 right-0 w-16 h-16 bg-white rounded-full translate-y-8 translate-x-8 animate-pulse delay-1500"></div>
                </div>
                <div className="relative z-10">
                  <div className="flex items-center space-x-3 mb-4">
                    <div className="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center">
                      <Smartphone className="w-6 h-6 text-white" />
                    </div>
                    <h3 className="text-xl font-bold">Device Control</h3>
                  </div>
                  <p className="text-white/80 text-sm">Block across all devices</p>
                </div>
              </div>
              
              <div className="p-6">
                <div className="space-y-4">
                  <div className="group/item text-center p-4 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl border border-blue-100 hover:shadow-lg transition-all duration-200 hover:scale-105">
                    <div className="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg group-hover/item:scale-110 transition-transform duration-300">
                      <Smartphone className="w-6 h-6 text-white" />
                    </div>
                    <div className="font-bold text-gray-900 mb-1">Phone</div>
                    <div className="text-sm text-gray-600">Mobile apps</div>
                  </div>
                  <div className="group/item text-center p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl border border-purple-100 hover:shadow-lg transition-all duration-200 hover:scale-105">
                    <div className="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg group-hover/item:scale-110 transition-transform duration-300">
                      <Monitor className="w-6 h-6 text-white" />
                    </div>
                    <div className="font-bold text-gray-900 mb-1">Computer</div>
                    <div className="text-sm text-gray-600">Desktop apps</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Card 3: Focus Tips */}
          <div className="relative group">
            <div className={`absolute inset-0 rounded-3xl blur-xl transition-all duration-500 group-hover:blur-2xl ${
              isDark 
                ? 'bg-gradient-to-r from-green-500/30 to-emerald-500/30 shadow-2xl shadow-green-500/20' 
                : 'bg-gradient-to-r from-green-500/20 to-emerald-500/20 shadow-2xl shadow-green-300/30'
            }`}></div>
            <div className={`relative backdrop-blur-sm rounded-3xl shadow-2xl border overflow-hidden transition-all duration-300 group-hover:scale-105 ${
              isDark 
                ? 'bg-white/10 border-white/20 group-hover:border-green-400/50' 
                : 'bg-white/90 border-white/20 group-hover:border-green-200/50'
            }`}>
              <div className="bg-gradient-to-br from-green-500 via-emerald-500 to-teal-600 p-6 text-white relative overflow-hidden">
                <div className="absolute inset-0 opacity-20">
                  <div className="absolute top-0 right-0 w-20 h-20 bg-white rounded-full -translate-y-10 translate-x-10 animate-pulse delay-1000"></div>
                  <div className="absolute bottom-0 left-0 w-16 h-16 bg-white rounded-full translate-y-8 -translate-x-8 animate-pulse delay-2000"></div>
                </div>
                <div className="relative z-10">
                  <div className="flex items-center space-x-3 mb-4">
                    <div className="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center">
                      <AlertTriangle className="w-6 h-6 text-white" />
                    </div>
                    <h3 className="text-xl font-bold">Focus Tips</h3>
                  </div>
                  <p className="text-white/80 text-sm">Boost your concentration</p>
                </div>
              </div>
              
              <div className="p-6">
                <div className="space-y-3">
                  <div className="flex items-center space-x-3 p-2">
                    <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span className="text-green-800 font-medium text-sm">Put phone away</span>
                  </div>
                  <div className="flex items-center space-x-3 p-2">
                    <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse delay-300"></div>
                    <span className="text-green-800 font-medium text-sm">Use headphones</span>
                  </div>
                  <div className="flex items-center space-x-3 p-2">
                    <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse delay-600"></div>
                    <span className="text-green-800 font-medium text-sm">Take breaks</span>
                  </div>
                  <div className="flex items-center space-x-3 p-2">
                    <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse delay-900"></div>
                    <span className="text-green-800 font-medium text-sm">Set goals</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Card 4: Session Stats */}
          <div className="relative group">
            <div className={`absolute inset-0 rounded-3xl blur-xl transition-all duration-500 group-hover:blur-2xl ${
              isDark 
                ? 'bg-gradient-to-r from-purple-500/30 to-pink-500/30 shadow-2xl shadow-purple-500/20' 
                : 'bg-gradient-to-r from-purple-500/20 to-pink-500/20 shadow-2xl shadow-purple-300/30'
            }`}></div>
            <div className={`relative backdrop-blur-sm rounded-3xl shadow-2xl border overflow-hidden transition-all duration-300 group-hover:scale-105 ${
              isDark 
                ? 'bg-white/10 border-white/20 group-hover:border-purple-400/50' 
                : 'bg-white/90 border-white/20 group-hover:border-purple-200/50'
            }`}>
              <div className="bg-gradient-to-br from-purple-500 via-pink-500 to-rose-600 p-6 text-white relative overflow-hidden">
                <div className="absolute inset-0 opacity-20">
                  <div className="absolute top-0 left-0 w-20 h-20 bg-white rounded-full -translate-y-10 -translate-x-10 animate-pulse delay-1500"></div>
                  <div className="absolute bottom-0 right-0 w-16 h-16 bg-white rounded-full translate-y-8 translate-x-8 animate-pulse delay-2500"></div>
                </div>
                <div className="relative z-10">
                  <div className="flex items-center space-x-3 mb-4">
                    <div className="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center">
                      <BarChart3 className="w-6 h-6 text-white" />
                    </div>
                    <h3 className="text-xl font-bold">Session Stats</h3>
                  </div>
                  <p className="text-white/80 text-sm">Track your progress</p>
                </div>
              </div>
              
              <div className="p-6">
                <div className="space-y-4">
                  <div className="text-center p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl border border-purple-100">
                    <div className="text-2xl font-bold text-purple-900 mb-1">{sessionHistory.length}</div>
                    <div className="text-sm text-purple-700">Sessions Completed</div>
                  </div>
                  <div className="text-center p-4 bg-gradient-to-br from-pink-50 to-rose-50 rounded-2xl border border-pink-100">
                    <div className="text-2xl font-bold text-pink-900 mb-1">{Math.floor(sessionHistory.reduce((acc, session) => acc + session.duration, 0) / 60)}</div>
                    <div className="text-sm text-pink-700">Total Hours</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Session History */}
        <div className="mt-12">
          <div className="relative">
            <div className={`absolute inset-0 rounded-3xl blur-xl ${
              isDark 
                ? 'bg-gradient-to-r from-green-500/20 to-emerald-500/20 shadow-2xl shadow-green-500/10' 
                : 'bg-gradient-to-r from-green-500/10 to-emerald-500/10 shadow-2xl shadow-green-300/20'
            }`}></div>
            <div className={`relative backdrop-blur-sm rounded-3xl shadow-2xl border overflow-hidden ${
              isDark 
                ? 'bg-white/10 border-white/20' 
                : 'bg-white/80 border-white/20'
            }`}>
              <div className="bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 p-6 text-white relative overflow-hidden">
                <div className="absolute inset-0 opacity-10">
                  <div className="absolute top-0 left-0 w-24 h-24 bg-white rounded-full -translate-x-12 -translate-y-12"></div>
                  <div className="absolute bottom-0 right-0 w-20 h-20 bg-white rounded-full translate-x-10 translate-y-10"></div>
                </div>
                
                <div className="relative z-10">
                  <div className="flex items-center space-x-3">
                    <div className="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
                      <Clock className="w-5 h-5 text-white" />
                    </div>
                    <h2 className="text-2xl font-bold text-white">Session History</h2>
                  </div>
                </div>
              </div>
              
              <div className="p-6">
                {sessionHistory.length > 0 ? (
                  <div className="space-y-4">
                    {sessionHistory.slice(-5).reverse().map((session) => (
                      <div key={session.id} className="group bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-6 border border-green-200 hover:shadow-lg transition-all duration-200 hover:scale-[1.02]">
                        <div className="flex items-center justify-between">
                          <div className="flex items-center space-x-4">
                            <div className="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg">
                              <Clock className="w-5 h-5 text-white" />
                            </div>
                            <div>
                              <div className="font-bold text-gray-900 text-lg">{session.type} Session</div>
                              <div className="text-sm text-gray-600">{session.duration} minutes ‚Ä¢ {formatSessionTime(session.startTime)}</div>
                            </div>
                          </div>
                          <div className="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-4 py-2 rounded-xl font-bold shadow-lg">
                            Completed
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                ) : (
                  <div className="text-center py-12">
                    <div className="w-16 h-16 bg-gradient-to-r from-gray-300 to-gray-400 rounded-xl flex items-center justify-center mx-auto mb-4">
                      <Clock className="w-8 h-8 text-white" />
                    </div>
                    <h3 className="text-lg font-semibold text-gray-900 mb-2">No Focus Sessions Yet</h3>
                    <p className="text-gray-600">Start your first focus session to see it here!</p>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Focus Reminder Modal */}
      {showFocusReminder && (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
          <div className={`relative max-w-md w-full rounded-3xl shadow-2xl border overflow-hidden ${
            isDark 
              ? 'bg-gradient-to-br from-slate-800 to-slate-900 border-white/20' 
              : 'bg-gradient-to-br from-white to-gray-50 border-gray-200'
          }`}>
            {/* Glow Effect */}
            <div className="absolute inset-0 bg-gradient-to-r from-orange-500/20 to-red-500/20 rounded-3xl blur-xl"></div>
            
            <div className="relative p-8 text-center">
              {/* Icon */}
              <div className="w-20 h-20 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl">
                <AlertTriangle className="w-10 h-10 text-white animate-pulse" />
              </div>
              
              {/* Title */}
              <h2 className={`text-2xl font-bold mb-4 ${
                isDark ? 'text-white' : 'text-gray-900'
              }`}>
                Stay Focused! üéØ
              </h2>
              
              {/* Message */}
              <p className={`text-lg mb-6 ${
                isDark ? 'text-white/80' : 'text-gray-600'
              }`}>
                You're in focus mode! You've left this page <span className="font-bold text-orange-500">{pageHiddenCount}</span> time{pageHiddenCount > 1 ? 's' : ''}.
              </p>
              
              {/* Stats */}
              <div className={`p-4 rounded-2xl mb-6 ${
                isDark ? 'bg-white/10 border border-white/20' : 'bg-gray-100 border border-gray-200'
              }`}>
                <div className="text-sm text-gray-500 mb-2">Focus Session Progress</div>
                <div className={`text-2xl font-bold ${
                  isDark ? 'text-white' : 'text-gray-900'
                }`}>
                  {Math.floor((25 * 60 - timeLeft) / 60)}:{(25 * 60 - timeLeft) % 60 < 10 ? '0' : ''}{(25 * 60 - timeLeft) % 60}
                </div>
                <div className="text-sm text-gray-500">of 25:00 completed</div>
              </div>
              
              {/* Action Buttons */}
              <div className="flex space-x-3">
                <button
                  onClick={() => setShowFocusReminder(false)}
                  className={`flex-1 py-3 px-6 rounded-xl font-semibold transition-all duration-200 ${
                    isDark 
                      ? 'bg-white/20 text-white hover:bg-white/30 border border-white/30' 
                      : 'bg-gray-200 text-gray-800 hover:bg-gray-300 border border-gray-300'
                  }`}
                >
                  Continue Focus
                </button>
                <button
                  onClick={stopSession}
                  className="flex-1 py-3 px-6 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-semibold hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl"
                >
                  End Session
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  )
}

export default FocusMode